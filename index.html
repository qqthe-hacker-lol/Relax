<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Relax Space Hub</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body { box-sizing: border-box; touch-action: manipulation; }
html, body { width: 100%; height: 100%; margin: 0; padding: 0; overscroll-behavior: none; }
.app-wrapper { width: 100%; height: 100%; }
.focus-outline:focus-visible { outline: 2px solid #ffffff; outline-offset: 3px; }

/* Animations */
@keyframes fadeOut {
0% { opacity: 1; transform: scale(0); }
100% { opacity: 0; transform: scale(2); }
}
@keyframes rippleExpand {
0% { width: 10px; height: 10px; opacity: 0.8; transform: scale(0.5); }
100% { width: 100px; height: 100px; opacity: 0; transform: scale(2.5); }
}
.breathing-anim { transition: transform 4s ease-in-out; }

/* Block Blast Styles */
.bb-cell { transition: background-color 0.2s, transform 0.1s; }
.bb-shape-btn { transition: transform 0.1s; }
.bb-shape-btn.selected { border: 2px solid #38bdf8; background-color: rgba(56, 189, 248, 0.1); transform: scale(1.1); }
</style>
</head>
<body>
<div id="relax-app" class="app-wrapper bg-[#1a1a1a] text-white flex items-stretch justify-center overflow-y-auto">

<div id="auth-screen" class="w-full max-w-md px-4 py-6 flex flex-col items-center justify-center gap-4">
<div class="w-full rounded-2xl p-6 border border-white/10 bg-white/5">
<h1 class="text-3xl font-semibold mb-2 text-center">Welcome</h1>
<p class="text-sm opacity-80 mb-6 text-center">Login to your space</p>
<form id="auth-form" class="flex flex-col gap-3">
<div><label for="auth-username" class="text-sm font-medium">Username</label> <input type="text" id="auth-username" name="auth-username" class="focus-outline w-full rounded-lg px-3 py-2 text-sm text-white bg-[#1a1a1a] border border-white/20 placeholder-white/30 mt-1" placeholder="Enter username..." required>
</div>
<div><label for="auth-password" class="text-sm font-medium">Password</label> <input type="password" id="auth-password" name="auth-password" class="focus-outline w-full rounded-lg px-3 py-2 text-sm text-white bg-[#1a1a1a] border border-white/20 placeholder-white/30 mt-1" placeholder="Enter password..." required>
</div>
<div class="flex gap-2"><button type="submit" id="login-btn" class="focus-outline text-sm px-5 py-2 rounded-full bg-[#38bdf8] hover:bg-[#0ea5e9] text-[#020617] font-semibold transition flex-1"> Login </button> <button type="button" id="register-btn" class="focus-outline text-sm px-5 py-2 rounded-full border border-white/20 hover:bg-white/10 transition flex-1"> Register </button>
</div>
</form>
</div>
</div>

<div id="main-app" class="hidden w-full max-w-5xl px-3 sm:px-4 py-4 sm:py-6 flex flex-col gap-3 sm:gap-4">
<header class="w-full flex items-center justify-between">
<div class="flex flex-col gap-1">
<h1 id="main-title" class="text-2xl sm:text-3xl font-semibold tracking-tight">Your Quiet Corner</h1>
<p id="subtitle-text" class="text-xs sm:text-sm opacity-80">Pick a mood, share a thought, join a group.</p>
</div>
<div class="flex items-center gap-2"><span id="current-username" class="text-xs sm:text-sm opacity-80"></span> <button type="button" id="logout-btn" class="focus-outline text-xs px-3 py-1.5 rounded-full border border-white/20 hover:bg-white/10 transition"> Logout </button>
</div>
</header>
<main class="flex-1 w-full flex flex-col gap-3 sm:gap-4">

<section class="w-full rounded-xl sm:rounded-2xl p-3 sm:p-4 border border-white/10 bg-white/5" id="mode-card">
<h2 id="modes-label" class="text-sm sm:text-base font-semibold mb-2 sm:mb-3">Choose your mood</h2>
<div class="flex flex-wrap gap-1.5 sm:gap-2" role="radiogroup">
<button type="button" class="mode-btn focus-outline text-xs sm:text-sm px-3 sm:px-4 py-1.5 sm:py-2 rounded-full border border-white/20 bg-white/10 hover:bg-white/20 transition" data-mode="Calm"> üåä Calm </button>
<button type="button" class="mode-btn focus-outline text-xs sm:text-sm px-3 sm:px-4 py-1.5 sm:py-2 rounded-full border border-white/10 hover:bg-white/15 transition" data-mode="Dreamy"> ‚ú® Dreamy </button>
<button type="button" class="mode-btn focus-outline text-xs sm:text-sm px-3 sm:px-4 py-1.5 sm:py-2 rounded-full border border-white/10 hover:bg-white/15 transition" data-mode="Cozy"> üî• Cozy </button>
<button type="button" class="mode-btn focus-outline text-xs sm:text-sm px-3 sm:px-4 py-1.5 sm:py-2 rounded-full border border-white/10 hover:bg-white/15 transition" data-mode="Good"> üòä Good </button>
<button type="button" class="mode-btn focus-outline text-xs sm:text-sm px-3 sm:px-4 py-1.5 sm:py-2 rounded-full border border-white/10 hover:bg-white/15 transition" data-mode="Sad"> üò¢ Sad </button>
<button type="button" class="mode-btn focus-outline text-xs sm:text-sm px-3 sm:px-4 py-1.5 sm:py-2 rounded-full border border-white/10 hover:bg-white/15 transition" data-mode="Angry"> üò§ Angry </button>
</div>
</section>

<section class="w-full rounded-xl sm:rounded-2xl p-3 sm:p-4 border border-white/10 bg-white/5">
<div class="flex items-center justify-between mb-2 sm:mb-3">
<h2 class="text-sm sm:text-base font-semibold">Groups</h2><button type="button" id="create-group-btn" class="focus-outline text-xs px-3 sm:px-4 py-1.5 sm:py-2 rounded-full bg-[#38bdf8] hover:bg-[#0ea5e9] text-[#020617] font-semibold transition"> + Create </button>
</div>
<div id="create-group-form" class="hidden mb-3 sm:mb-4 p-2.5 sm:p-3 rounded-xl bg-[#020617]/50 border border-white/20">
<form id="group-form" class="flex flex-col gap-2.5 sm:gap-3">
<div><label for="group-name" class="text-xs sm:text-sm font-medium">Group Name</label> <input type="text" id="group-name" name="group-name" class="focus-outline w-full rounded-lg px-2.5 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm text-white bg-[#1a1a1a] border border-white/20 placeholder-white/30 mt-1" placeholder="Enter group name..." required>
</div>
<div><label for="group-password" class="text-xs sm:text-sm font-medium">Password (optional)</label> <input type="password" id="group-password" name="group-password" class="focus-outline w-full rounded-lg px-2.5 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm text-white bg-[#1a1a1a] border border-white/20 placeholder-white/30 mt-1" placeholder="Leave empty for no password...">
</div>
<div class="flex gap-2"><button type="submit" class="focus-outline text-xs sm:text-sm px-3 sm:px-4 py-1.5 sm:py-2 rounded-full bg-[#38bdf8] hover:bg-[#0ea5e9] text-[#020617] font-semibold transition"> Create </button> <button type="button" id="cancel-group-btn" class="focus-outline text-xs sm:text-sm px-3 sm:px-4 py-1.5 sm:py-2 rounded-full border border-white/20 hover:bg-white/10 transition"> Cancel </button>
</div>
</form>
</div>
<div id="groups-list" class="flex flex-wrap gap-1.5 sm:gap-2">
<button type="button" id="all-posts-btn" class="focus-outline text-xs sm:text-sm px-3 sm:px-4 py-1.5 sm:py-2 rounded-full border border-white/30 bg-white/20 hover:bg-white/25 transition"> üìã All Posts </button>
</div>
</section>

<div id="main-view" class="w-full flex flex-col gap-3 sm:gap-4">
<div class="w-full grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4">
<section class="rounded-xl sm:rounded-2xl p-3 sm:p-4 border border-white/10 bg-white/5">
<h2 class="text-sm sm:text-base font-semibold mb-2 sm:mb-3">Share a thought</h2>
<form id="post-form" class="flex flex-col gap-2.5 sm:gap-3"><textarea id="post-text" name="post-text" rows="3" class="focus-outline w-full rounded-xl px-2.5 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm text-white bg-[#020617]/50 border border-white/20 placeholder-white/30 resize-none" placeholder="What's on your mind?"></textarea>
<div class="flex items-center justify-between gap-2 sm:gap-3">
<p id="form-status" class="text-xs opacity-80"></p><button id="post-submit" type="submit" class="focus-outline text-xs sm:text-sm px-4 sm:px-5 py-1.5 sm:py-2 rounded-full bg-[#38bdf8] hover:bg-[#0ea5e9] text-[#020617] font-semibold transition"> Share </button>
</div>
</form>
</section>
<section class="rounded-xl sm:rounded-2xl p-3 sm:p-4 border border-white/10 bg-white/5 flex flex-col gap-2 sm:gap-3">
<h2 class="text-sm sm:text-base font-semibold" id="feed-title">Community Board</h2>
<div id="feed-empty" class="text-xs sm:text-sm opacity-75">No posts yet.</div>
<ul id="feed-list" class="flex flex-col gap-2 text-xs sm:text-sm max-h-64 overflow-y-auto pr-1"></ul>
</section>
</div>
</div>

<div id="group-view" class="hidden w-full flex flex-col gap-3 sm:gap-4">
<div class="w-full rounded-xl sm:rounded-2xl p-3 sm:p-4 border border-white/10 bg-white/5 flex items-center justify-between">
<h2 id="group-view-title" class="text-base sm:text-lg font-semibold">Group Chat</h2>
<button type="button" id="exit-group-btn" class="focus-outline text-xs sm:text-sm px-2.5 sm:px-4 py-1.5 sm:py-2 rounded-full border border-white/20 hover:bg-white/10 transition"> ‚Üê Back to Main </button>
</div>
<div class="w-full rounded-xl sm:rounded-2xl p-3 sm:p-4 border border-white/10 bg-white/5 flex flex-col gap-3 sm:gap-4">
<ul id="group-messages-list" class="flex flex-col gap-2 text-xs sm:text-sm max-h-96 overflow-y-auto pr-1 min-h-[150px]">
<li class="text-center opacity-50 italic mt-4">Welcome to the group chat.</li>
</ul>
<form id="group-message-form" class="flex flex-col gap-2.5 sm:gap-3 border-t border-white/10 pt-3 sm:pt-4">
<textarea id="group-message-text" rows="2" class="focus-outline w-full rounded-xl px-2.5 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm text-white bg-[#020617]/50 border border-white/20 placeholder-white/30 resize-none" placeholder="Type message..."></textarea>
<button type="submit" class="focus-outline text-xs sm:text-sm px-4 sm:px-5 py-1.5 sm:py-2 rounded-full bg-[#38bdf8] hover:bg-[#0ea5e9] text-[#020617] font-semibold self-end">Send</button>
</form>
</div>
</div>

<section class="w-full rounded-xl sm:rounded-2xl p-3 sm:p-4 border border-white/10 bg-white/5 flex flex-col gap-2 sm:gap-3">
<div class="flex items-center justify-between">
<h2 class="text-sm sm:text-base font-semibold">üíô Talk to Someone</h2><button type="button" id="toggle-ai-chat" class="focus-outline text-xs sm:text-sm px-3 sm:px-4 py-1.5 sm:py-2 rounded-full bg-[#38bdf8] hover:bg-[#0ea5e9] text-[#020617] font-semibold transition"> Chat </button>
</div>
<div id="ai-chat-area" class="hidden flex flex-col gap-2 sm:gap-3 border-t border-white/10 pt-2 sm:pt-3">
<div class="flex flex-col gap-2 max-h-64 overflow-y-auto pr-1" id="ai-messages"></div>
<form id="ai-chat-form" class="flex flex-col gap-1.5 sm:gap-2"><textarea id="ai-chat-input" rows="2" class="focus-outline w-full rounded-xl px-2.5 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm text-white bg-[#020617]/50 border border-white/20 placeholder-white/30 resize-none"></textarea>
<button type="submit" class="focus-outline text-xs sm:text-sm px-4 sm:px-5 py-1.5 sm:py-2 rounded-full bg-[#38bdf8] hover:bg-[#0ea5e9] text-[#020617] font-semibold self-end"> Send </button>
</form>
</div>
</section>

<section class="w-full rounded-xl sm:rounded-2xl p-3 sm:p-4 border border-white/10 bg-white/5 flex flex-col gap-3 sm:gap-4">
<div class="flex flex-col sm:flex-row sm:items-center justify-between gap-2">
<h2 class="text-sm sm:text-base font-semibold">Mini Games</h2>
<div class="flex flex-wrap gap-1.5 sm:gap-2">
<button type="button" class="game-btn focus-outline text-xs px-2.5 sm:px-3 py-1 rounded-full border border-white/20 bg-white/10 hover:bg-white/20" data-game="breathing">ü´Å Breathe</button>
<button type="button" class="game-btn focus-outline text-xs px-2.5 sm:px-3 py-1 rounded-full border border-white/10 hover:bg-white/15" data-game="stars">‚≠ê Stars</button>
<button type="button" class="game-btn focus-outline text-xs px-2.5 sm:px-3 py-1 rounded-full border border-white/10 hover:bg-white/15" data-game="ripple">üíß Ripple</button>
<button type="button" class="game-btn focus-outline text-xs px-2.5 sm:px-3 py-1 rounded-full border border-white/10 hover:bg-white/15" data-game="drawing">üé® Drawing</button>
<button type="button" class="game-btn focus-outline text-xs px-2.5 sm:px-3 py-1 rounded-full border border-white/10 hover:bg-white/15" data-game="blockblast">üß± Block Blast</button>
<button type="button" class="game-btn focus-outline text-xs px-2.5 sm:px-3 py-1 rounded-full border border-white/10 hover:bg-white/15" data-game="popcorn">üçø Popcorn</button>
<button type="button" class="game-btn focus-outline text-xs px-2.5 sm:px-3 py-1 rounded-full border border-white/10 hover:bg-white/15" data-game="snake">üêç Snake Battle</button>
</div>
</div>

<div id="breathing-game" class="hidden flex-col items-center gap-3 sm:gap-4">
<div class="w-28 h-28 sm:w-32 sm:h-32 rounded-full border-2 border-[#38bdf8] flex items-center justify-center bg-white/5 breathing-anim" id="breathing-circle"><span id="breathing-label" class="text-xs sm:text-sm opacity-80">Inhale‚Ä¶</span>
</div><button type="button" id="breathing-toggle" class="focus-outline text-xs sm:text-sm px-4 sm:px-5 py-1.5 sm:py-2 rounded-full bg-[#38bdf8] hover:bg-[#0ea5e9] text-[#020617] font-semibold transition"> Start </button>
</div>

<div id="stars-game" class="hidden flex-col items-center gap-3 sm:gap-4">
<div class="w-full h-40 sm:h-48 rounded-xl border border-white/10 relative overflow-hidden" id="stars-canvas" style="background-color: #2a2a2a;"></div>
<p class="text-xs opacity-75 text-center">Tap to create stars</p>
</div>

<div id="ripple-game" class="hidden flex-col items-center gap-3 sm:gap-4">
<div class="w-full h-40 sm:h-48 rounded-xl border border-white/10 relative overflow-hidden" id="ripple-canvas" style="background-color: #2a2a2a; touch-action: none;"></div>
<p class="text-xs opacity-75 text-center">Move to create large ripples</p>
</div>

<div id="drawing-game" class="hidden flex-col gap-3 sm:gap-4">
<div class="flex flex-col gap-2">
<div class="flex justify-between items-center"><span class="text-xs opacity-70">Tools:</span> <button id="clear-canvas" class="text-xs border px-2 py-1 rounded border-white/20">Clear</button></div>
<div class="flex flex-wrap gap-2">
<button class="tool-btn text-xs px-2 py-1 rounded bg-[#38bdf8]/20 border border-[#38bdf8]" data-tool="pen">üñäÔ∏è Pen</button>
<button class="tool-btn text-xs px-2 py-1 rounded border border-white/20" data-tool="brush">üñåÔ∏è Brush</button>
<button class="tool-btn text-xs px-2 py-1 rounded border border-white/20" data-tool="marker">‚úèÔ∏è Marker</button>
<button class="tool-btn text-xs px-2 py-1 rounded border border-white/20" data-tool="eraser">üßπ Eraser</button>
</div>
<div class="flex flex-wrap gap-2 items-center">
<span class="text-xs opacity-60">Size:</span>
<button class="size-btn text-xs px-2 py-1 rounded border border-white/20" data-size="2">Thin</button>
<button class="size-btn text-xs px-2 py-1 rounded bg-[#38bdf8]/20 border border-[#38bdf8]" data-size="5">Normal</button>
<button class="size-btn text-xs px-2 py-1 rounded border border-white/20" data-size="10">Thick</button>
</div>
<div class="flex flex-wrap gap-2">
<button class="color-btn w-6 h-6 rounded-full bg-[#38bdf8] border-2 border-white" data-draw-color="#38bdf8"></button>
<button class="color-btn w-6 h-6 rounded-full bg-[#ffffff] border-2 border-white/20" data-draw-color="#ffffff"></button>
<button class="color-btn w-6 h-6 rounded-full bg-[#ef4444] border-2 border-white/20" data-draw-color="#ef4444"></button>
<button class="color-btn w-6 h-6 rounded-full bg-[#22c55e] border-2 border-white/20" data-draw-color="#22c55e"></button>
<button class="color-btn w-6 h-6 rounded-full bg-[#eab308] border-2 border-white/20" data-draw-color="#eab308"></button>
<button class="color-btn w-6 h-6 rounded-full bg-[#a855f7] border-2 border-white/20" data-draw-color="#a855f7"></button>
</div>
</div>
<canvas id="drawing-canvas" width="800" height="400" class="w-full rounded-xl border border-white/10 cursor-crosshair" style="background-color: #2a2a2a; touch-action: none;"></canvas>
</div>

<div id="blockblast-game" class="hidden flex-col gap-3 sm:gap-4">
<div class="flex items-center justify-between gap-2">
<p class="text-xs sm:text-sm font-semibold">Score: <span id="bb-score">0</span></p>
<button type="button" id="bb-reset" class="focus-outline text-xs px-2.5 sm:px-3 py-1 rounded-full border border-white/20 hover:bg-white/15">Restart</button>
</div>
<div id="bb-grid" class="grid grid-cols-8 gap-0.5 sm:gap-1 w-full max-w-[300px] mx-auto p-1.5 sm:p-2 rounded-xl bg-[#020617]/50 border border-white/10 aspect-square"></div>
<div id="bb-shapes" class="flex justify-center gap-4 h-24 items-center"></div>
</div>

<div id="popcorn-game" class="hidden flex-col gap-3 sm:gap-4">
<div class="flex items-center justify-between gap-2">
<p class="text-xs sm:text-sm font-semibold">Score: <span id="popcorn-score">0</span></p>
<button type="button" id="popcorn-reset" class="focus-outline text-xs px-2.5 sm:px-3 py-1 rounded-full border border-white/20 hover:bg-white/15">Start</button>
</div>
<canvas id="popcorn-canvas" width="600" height="400" class="w-full rounded-xl border border-white/10" style="background: linear-gradient(to bottom, #2a2a2a, #1a1a1a); touch-action: none;"></canvas>
</div>

<div id="snake-game" class="hidden flex-col gap-3 sm:gap-4">
<div id="snake-menu" class="flex flex-col items-center justify-center gap-4 h-64 bg-white/5 rounded-xl border border-white/10">
<h3 class="text-lg font-bold">Snake Battle Arena</h3>
<div class="flex gap-3">
<button id="snake-single-btn" class="px-4 py-2 bg-[#38bdf8] text-black rounded-full font-bold hover:bg-[#0ea5e9]">Play vs Bots</button>
<button id="snake-online-btn" class="px-4 py-2 border border-white/30 rounded-full hover:bg-white/10">Online Mode</button>
</div>
</div>
<div id="snake-servers" class="hidden flex-col gap-3 h-64 bg-white/5 rounded-xl border border-white/10 p-4">
<h3 class="text-sm font-bold border-b border-white/10 pb-2">Select Server</h3>
<div class="flex flex-col gap-2 overflow-y-auto">
<button class="server-item text-left px-3 py-2 bg-white/5 hover:bg-white/10 rounded flex justify-between" data-server="NA-East-1">
<span>Server: NA-East-1</span> <span class="text-[#22c55e]">3/10 Players</span>
</button>
</div>
<button id="back-to-menu" class="text-xs text-center mt-2 opacity-50">Back</button>
</div>
<div id="snake-lobby" class="hidden flex-col gap-3 h-64 bg-white/5 rounded-xl border border-white/10 p-4">
<div class="flex justify-between items-center border-b border-white/10 pb-2">
<h3 class="text-sm font-bold">Lobby</h3>
<span class="text-xs opacity-70" id="lobby-server-name"></span>
</div>
<div class="flex-1 overflow-y-auto" id="lobby-list"></div>
<button id="lobby-start-btn" class="w-full py-2 bg-[#22c55e] text-black font-bold rounded-lg opacity-50 cursor-not-allowed">Waiting for Leader...</button>
</div>
<div id="snake-play-area" class="hidden flex-col gap-2">
<div class="flex justify-between">
<span id="snake-status-text" class="text-xs font-bold text-[#38bdf8]">Alive</span>
<button id="snake-quit" class="text-xs px-2 border rounded border-white/20">Quit</button>
</div>
<canvas id="snake-canvas" width="600" height="400" class="w-full rounded-xl border border-white/10" style="background-color: #2a2a2a;"></canvas>
</div>
</div>
</section>
</main>
</div>
</div>

<script>
// --- BASIC AUTH & SETUP ---
let currentUser = sessionStorage.getItem('relaxUser');
let isAdmin = false;
let allGroups = []; // Store group objects here

function showApp(name) {
document.getElementById('current-username').textContent = "Hi, " + name;
document.getElementById('auth-screen').classList.add('hidden');
document.getElementById('main-app').classList.remove('hidden');

// ADMIN CHECK FOR Ray_irl
if(name === 'Ray_irl') {
isAdmin = true;
document.getElementById('current-username').innerHTML = "Hi, Ray_irl <span class='text-xs bg-red-500 px-1 rounded ml-1'>ADMIN</span>";
}
}

if(currentUser) {
showApp(currentUser);
}

document.getElementById('auth-form').addEventListener('submit', (e) => {
e.preventDefault();
const val = document.getElementById('auth-username').value;
if(val) {
currentUser = val;
sessionStorage.setItem('relaxUser', currentUser);
showApp(currentUser);
}
});

document.getElementById('logout-btn').addEventListener('click', () => {
sessionStorage.removeItem('relaxUser');
location.reload();
});

// --- NAVIGATION HELPERS ---
function showMainView() {
document.getElementById('main-view').classList.remove('hidden');
document.getElementById('group-view').classList.add('hidden');
}
function showGroupView(groupName) {
document.getElementById('main-view').classList.add('hidden');
document.getElementById('group-view').classList.remove('hidden');
document.getElementById('group-view-title').textContent = groupName;
}

document.getElementById('all-posts-btn').onclick = showMainView;
document.getElementById('exit-group-btn').onclick = showMainView;


// --- FIX: GROUP CREATION & JOINING LOGIC ---
const groupForm = document.getElementById('create-group-form');
document.getElementById('create-group-btn').onclick = () => groupForm.classList.remove('hidden');
document.getElementById('cancel-group-btn').onclick = () => groupForm.classList.add('hidden');

document.getElementById('group-form').addEventListener('submit', (e) => {
e.preventDefault();
const gName = document.getElementById('group-name').value;
const gPass = document.getElementById('group-password').value;

if(gName) {
// Save group data so we can check password later
const newGroup = { name: gName, password: gPass };
allGroups.push(newGroup);

// Create Button
const btn = document.createElement('button');
btn.type = 'button';
btn.className = "focus-outline text-xs sm:text-sm px-3 sm:px-4 py-1.5 sm:py-2 rounded-full border border-white/10 hover:bg-white/15 transition";
btn.textContent = "# " + gName + (gPass ? " üîí" : "");

// JOIN LOGIC
btn.onclick = () => {
if(isAdmin) {
// Ray_irl bypasses everything
showGroupView("# " + gName);
} else if (newGroup.password) {
// Normal user + password exists
let attempt = prompt("Enter password for " + gName + ":");
if(attempt === newGroup.password) {
showGroupView("# " + gName);
} else {
alert("Wrong password!");
}
} else {
// No password
showGroupView("# " + gName);
}
};

document.getElementById('groups-list').appendChild(btn);

// Clean up
document.getElementById('group-name').value = '';
document.getElementById('group-password').value = '';
groupForm.classList.add('hidden');
}
});

// --- FIX: POST MESSAGE & ADMIN DELETE (Ray_irl) ---
document.getElementById('post-form').addEventListener('submit', (e) => {
e.preventDefault();
const text = document.getElementById('post-text').value;
if(!text) return;

const list = document.getElementById('feed-list');
const empty = document.getElementById('feed-empty');
if(empty) empty.classList.add('hidden');

const li = document.createElement('li');
li.className = "p-2 rounded bg-white/5 border border-white/5 flex justify-between items-start";

// Post content
const contentDiv = document.createElement('div');
contentDiv.innerHTML = `<span class="font-bold text-[#38bdf8]">${currentUser}:</span> ${text}`;
li.appendChild(contentDiv);

// Admin Delete Button (Only for Ray_irl)
if(isAdmin) {
const delBtn = document.createElement('button');
delBtn.innerText = "Delete";
delBtn.className = "text-white bg-red-500 hover:bg-red-600 text-[10px] uppercase font-bold ml-2 px-2 py-0.5 rounded";
delBtn.onclick = () => li.remove();
li.appendChild(delBtn);
}

list.prepend(li);
document.getElementById('post-text').value = '';
});

// Group Chat Messages (Mock)
document.getElementById('group-message-form').addEventListener('submit', (e) => {
e.preventDefault();
const txt = document.getElementById('group-message-text').value;
if(txt) {
const list = document.getElementById('group-messages-list');
const li = document.createElement('li');
li.className = "p-2 bg-white/5 rounded border border-white/5";
li.innerHTML = `<span class="font-bold text-[#38bdf8]">${currentUser}:</span> ${txt}`;
list.appendChild(li);
document.getElementById('group-message-text').value = '';
list.scrollTop = list.scrollHeight;
}
});

// --- MODE SELECTOR ---
function applyMode(mode) {
const app = document.getElementById('relax-app');
app.style.backgroundColor = "#1a1a1a";
app.style.backgroundImage = "none";
if(mode === "Calm") app.style.backgroundImage = "radial-gradient(circle at top left, rgba(56,189,248,0.2), transparent 50%)";
if(mode === "Dreamy") app.style.backgroundImage = "radial-gradient(circle at top, rgba(168,85,247,0.2), transparent 50%)";
if(mode === "Cozy") app.style.backgroundImage = "radial-gradient(circle at bottom, rgba(248,113,113,0.2), transparent 50%)";
}
document.querySelectorAll('.mode-btn').forEach(b => b.addEventListener('click', () => applyMode(b.dataset.mode)));
applyMode('Calm');

// --- GAME SWITCHING ---
const gameDivs = {
'breathing': document.getElementById('breathing-game'),
'drawing': document.getElementById('drawing-game'),
'stars': document.getElementById('stars-game'),
'ripple': document.getElementById('ripple-game'),
'blockblast': document.getElementById('blockblast-game'),
'popcorn': document.getElementById('popcorn-game'),
'snake': document.getElementById('snake-game')
};
document.querySelectorAll('.game-btn').forEach(btn => {
btn.addEventListener('click', () => {
Object.values(gameDivs).forEach(d => d.classList.add('hidden'));
const g = btn.dataset.game;
gameDivs[g].classList.remove('hidden');
gameDivs[g].classList.add('flex');

if(g === 'drawing') resizeDrawingCanvas();
if(g === 'blockblast') initBlockBlast();
if(g === 'popcorn') initPopcorn();
if(g === 'snake') resetSnakeUI();
});
});

// --- 1. BREATHING ---
let bState = false, bInt;
document.getElementById('breathing-toggle').addEventListener('click', function() {
bState = !bState;
const c = document.getElementById('breathing-circle');
const l = document.getElementById('breathing-label');
if(bState) {
this.textContent = "Stop";
let inhale = true;
c.style.transform = "scale(1.2)";
bInt = setInterval(() => {
inhale = !inhale;
l.textContent = inhale ? "Inhale..." : "Exhale...";
c.style.transform = inhale ? "scale(1.2)" : "scale(1)";
}, 4000);
} else {
this.textContent = "Start";
clearInterval(bInt);
c.style.transform = "scale(1)";
l.textContent = "Press Start";
}
});

// --- 2. RIPPLE ---
const rCanvas = document.getElementById('ripple-canvas');
function createRipple(x, y) {
const r = document.createElement('div');
r.className = "absolute rounded-full border-2 border-[#38bdf8]";
r.style.left = (x - 50) + 'px'; // Center it
r.style.top = (y - 50) + 'px';
r.style.width = '100px';
r.style.height = '100px';
r.style.animation = "rippleExpand 2s ease-out forwards";
rCanvas.appendChild(r);
setTimeout(() => r.remove(), 2000);
}
rCanvas.addEventListener('mousemove', (e) => {
const rect = rCanvas.getBoundingClientRect();
createRipple(e.clientX - rect.left, e.clientY - rect.top);
});
rCanvas.addEventListener('touchmove', (e) => {
e.preventDefault();
const rect = rCanvas.getBoundingClientRect();
if(e.touches.length > 0) {
createRipple(e.touches[0].clientX - rect.left, e.touches[0].clientY - rect.top);
}
}, {passive: false});

// --- 3. DRAWING ---
const dCvs = document.getElementById('drawing-canvas');
const dCtx = dCvs.getContext('2d');
let dPainting = false;
let dColor = '#38bdf8';
let dTool = 'pen';
let dSize = 5;

function resizeDrawingCanvas() {
// Placeholder for resizing logic if needed
}
function getDrawPos(e) {
const rect = dCvs.getBoundingClientRect();
const clientX = e.touches ? e.touches[0].clientX : e.clientX;
const clientY = e.touches ? e.touches[0].clientY : e.clientY;
return {
x: (clientX - rect.left) * (dCvs.width / rect.width),
y: (clientY - rect.top) * (dCvs.height / rect.height)
};
}
function startDraw(e) { dPainting = true; draw(e); }
function endDraw() { dPainting = false; dCtx.beginPath(); }
function draw(e) {
if(!dPainting) return;
const pos = getDrawPos(e);
dCtx.lineWidth = dSize;
dCtx.lineCap = 'round';

if(dTool === 'eraser') {
dCtx.globalCompositeOperation = 'destination-out';
} else {
dCtx.globalCompositeOperation = 'source-over';
dCtx.strokeStyle = dColor;
dCtx.globalAlpha = (dTool === 'marker') ? 0.4 : 1.0;
if(dTool === 'brush') {
dCtx.shadowBlur = 5;
dCtx.shadowColor = dColor;
} else {
dCtx.shadowBlur = 0;
}
}
dCtx.lineTo(pos.x, pos.y);
dCtx.stroke();
dCtx.beginPath();
dCtx.moveTo(pos.x, pos.y);
}

dCvs.addEventListener('mousedown', startDraw);
dCvs.addEventListener('mouseup', endDraw);
dCvs.addEventListener('mousemove', draw);
dCvs.addEventListener('touchstart', (e) => { e.preventDefault(); startDraw(e); }, {passive: false});
dCvs.addEventListener('touchend', (e) => { e.preventDefault(); endDraw(e); }, {passive: false});
dCvs.addEventListener('touchmove', (e) => { e.preventDefault(); draw(e); }, {passive: false});

document.getElementById('clear-canvas').addEventListener('click', () => dCtx.clearRect(0,0,800,400));

// Tools logic
document.querySelectorAll('.tool-btn').forEach(b => b.addEventListener('click', () => {
dTool = b.dataset.tool;
document.querySelectorAll('.tool-btn').forEach(t => t.classList.remove('bg-[#38bdf8]/20', 'border-[#38bdf8]'));
b.classList.add('bg-[#38bdf8]/20', 'border-[#38bdf8]');
}));
document.querySelectorAll('.size-btn').forEach(b => b.addEventListener('click', () => {
dSize = parseInt(b.dataset.size);
document.querySelectorAll('.size-btn').forEach(t => t.classList.remove('bg-[#38bdf8]/20', 'border-[#38bdf8]'));
b.classList.add('bg-[#38bdf8]/20', 'border-[#38bdf8]');
}));
document.querySelectorAll('.color-btn').forEach(b => b.addEventListener('click', () => {
dColor = b.dataset.drawColor;
document.querySelectorAll('.color-btn').forEach(c => c.style.borderWidth = '2px');
document.querySelectorAll('.color-btn').forEach(c => c.style.borderColor = 'rgba(255,255,255,0.2)');
b.style.borderColor = 'white';
}));

// --- 4. POPCORN ---
function initPopcorn() {
const cvs = document.getElementById('popcorn-canvas');
const ctx = cvs.getContext('2d');
let py = 350, pvy = 0, gravity = 0.6;
let obstacles = [];
let score = 0;
let active = true;

cvs.onmousedown = jump;
cvs.ontouchstart = (e) => { e.preventDefault(); jump(); };
function jump() { if(py >= 340) pvy = -12; }

function loop() {
if(!active) return;
ctx.clearRect(0,0,600,400);
py += pvy;
pvy += gravity;
if(py > 350) { py = 350; pvy = 0; }
ctx.fillStyle = "#eab308";
ctx.fillRect(50, py, 30, 30);

if(Math.random() < 0.015) obstacles.push({x:600, y:360});
obstacles.forEach((o, i) => {
o.x -= 4;
ctx.fillStyle = "#f43f5e";
ctx.fillRect(o.x, o.y, 20, 20);
if(o.x < -20) { obstacles.splice(i,1); score++; document.getElementById('popcorn-score').innerText = score; }
if(o.x < 80 && o.x > 20 && py > 330) {
active = false;
ctx.fillStyle = "white";
ctx.font = "30px sans-serif";
ctx.fillText("Game Over", 230, 200);
}
});
requestAnimationFrame(loop);
}
document.getElementById('popcorn-reset').onclick = () => {
obstacles=[]; score=0; active=true; py=350; pvy=0; loop();
};
loop();
}

// --- 5. BLOCK BLAST ---
const bbGridSize = 8;
let bbGrid = Array(64).fill(null);
let bbScore = 0;
let bbSelectedShapeIdx = -1;
let bbCurrentShapes = [];
const shapes = [
[[0,0]], [[0,0], [0,1]], [[0,0], [1,0]], [[0,0], [0,1], [0,2]],
[[0,0], [1,0], [2,0]], [[0,0], [0,1], [1,0], [1,1]], [[0,0], [1,0], [2,0], [2,1]]
];
function initBlockBlast() {
bbGrid = Array(64).fill(null);
bbScore = 0;
renderBBGrid();
generateBBShapes();
}
function renderBBGrid() {
const container = document.getElementById('bb-grid');
container.innerHTML = '';
bbGrid.forEach((cell, i) => {
const div = document.createElement('div');
div.className = `w-full h-full rounded cursor-pointer border border-white/5 ${cell ? 'bg-[#38bdf8]' : 'bg-white/10'}`;
div.onclick = () => placeShape(i);
container.appendChild(div);
});
}
function generateBBShapes() {
bbCurrentShapes = [];
const container = document.getElementById('bb-shapes');
container.innerHTML = '';
bbSelectedShapeIdx = -1;
for(let i=0; i<3; i++) {
const shapeDef = shapes[Math.floor(Math.random() * shapes.length)];
bbCurrentShapes.push(shapeDef);
const btn = document.createElement('div');
btn.className = "bb-shape-btn w-16 h-16 bg-white/5 rounded-lg flex items-center justify-center cursor-pointer";
btn.onclick = () => selectShape(i, btn);
const miniGrid = document.createElement('div');
miniGrid.style.display = 'grid';
const w = Math.max(...shapeDef.map(p => p[1])) + 1;
const h = Math.max(...shapeDef.map(p => p[0])) + 1;
miniGrid.style.gridTemplateColumns = `repeat(${w}, 10px)`;
miniGrid.style.gap = '2px';
for(let r=0; r<h; r++) {
for(let c=0; c<w; c++) {
const cell = document.createElement('div');
const isPart = shapeDef.some(p => p[0]===r && p[1]===c);
cell.style.width = '10px'; cell.style.height = '10px';
cell.style.backgroundColor = isPart ? '#38bdf8' : 'transparent';
if(isPart) cell.style.borderRadius = '2px';
miniGrid.appendChild(cell);
}
}
btn.appendChild(miniGrid);
container.appendChild(btn);
}
}
function selectShape(idx, el) {
if(bbCurrentShapes[idx] === null) return;
bbSelectedShapeIdx = idx;
document.querySelectorAll('.bb-shape-btn').forEach(b => b.classList.remove('selected'));
el.classList.add('selected');
}
function placeShape(gridIdx) {
if(bbSelectedShapeIdx === -1) return;
const shape = bbCurrentShapes[bbSelectedShapeIdx];
if(!shape) return;
const startR = Math.floor(gridIdx / bbGridSize);
const startC = gridIdx % bbGridSize;
let fits = true;
for(let p of shape) {
const r = startR + p[0];
const c = startC + p[1];
if(r >= bbGridSize || c >= bbGridSize || bbGrid[r*bbGridSize + c] !== null) { fits = false; break; }
}
if(fits) {
for(let p of shape) { bbGrid[(startR + p[0])*bbGridSize + (startC + p[1])] = '#38bdf8'; }
bbCurrentShapes[bbSelectedShapeIdx] = null;
bbSelectedShapeIdx = -1;
checkLines();
renderBBGrid();
generateBBShapes();
if(bbCurrentShapes.every(s => s === null)) generateBBShapes();
}
}
function checkLines() {
let lines = 0;
for(let r=0; r<bbGridSize; r++) {
let full = true;
for(let c=0; c<bbGridSize; c++) if(!bbGrid[r*bbGridSize+c]) full=false;
if(full) { for(let c=0; c<bbGridSize; c++) bbGrid[r*bbGridSize+c]=null; lines++; }
}
for(let c=0; c<bbGridSize; c++) {
let full = true;
for(let r=0; r<bbGridSize; r++) if(!bbGrid[r*bbGridSize+c]) full=false;
if(full) { for(let r=0; r<bbGridSize; r++) bbGrid[r*bbGridSize+c]=null; lines++; }
}
if(lines>0) { bbScore+=lines*100; document.getElementById('bb-score').innerText=bbScore; }
}
document.getElementById('bb-reset').addEventListener('click', initBlockBlast);

// --- 6. SNAKE BATTLE ---
const sMenu = document.getElementById('snake-menu');
const sServers = document.getElementById('snake-servers');
const sLobby = document.getElementById('snake-lobby');
const sPlay = document.getElementById('snake-play-area');
const sCanvas = document.getElementById('snake-canvas');
const sCtx = sCanvas.getContext('2d');

let snakeInterval;
let snakes = [];

function resetSnakeUI() {
sMenu.classList.remove('hidden');
sServers.classList.add('hidden');
sLobby.classList.add('hidden');
sPlay.classList.add('hidden');
clearInterval(snakeInterval);
}

document.getElementById('snake-single-btn').onclick = () => startGame(false);
document.getElementById('snake-online-btn').onclick = () => {
sMenu.classList.add('hidden');
sServers.classList.remove('hidden');
sServers.classList.add('flex');
};
document.getElementById('back-to-menu').onclick = resetSnakeUI;
document.getElementById('snake-quit').onclick = resetSnakeUI;

document.querySelectorAll('.server-item').forEach(btn => {
btn.onclick = function() {
const serverName = this.dataset.server;
sServers.classList.add('hidden');
sLobby.classList.remove('hidden');
sLobby.classList.add('flex');
document.getElementById('lobby-server-name').innerText = serverName;
startLobbySim();
}
});

function startLobbySim() {
const list = document.getElementById('lobby-list');
list.innerHTML = `<div class="p-2 border-b border-white/5 text-[#38bdf8]">You (Joined)</div>`;
const btn = document.getElementById('lobby-start-btn');
btn.innerText = "Waiting for Host...";
btn.className = "w-full py-2 bg-[#22c55e] text-black font-bold rounded-lg opacity-50 cursor-not-allowed transition";

const bots = ["Bot_Alpha", "Slayer_99", "Pro_Snake"];
let count = 0;

const joinInt = setInterval(() => {
if(count >= bots.length) {
clearInterval(joinInt);
btn.innerText = "Host Starting Game...";
setTimeout(() => {
sLobby.classList.add('hidden');
startGame(true);
}, 1500);
return;
}
const div = document.createElement('div');
div.className = "p-2 border-b border-white/5";
div.innerText = bots[count];
list.appendChild(div);
count++;
}, 1000);
}

function startGame(online) {
sMenu.classList.add('hidden');
sPlay.classList.remove('hidden');
sPlay.classList.add('flex');

snakes = [];
snakes.push({
id: 'player', color: '#38bdf8', body: [{x:10, y:10}, {x:9, y:10}, {x:8, y:10}],
dx: 1, dy: 0, dead: false
});

const botColors = ['#ef4444', '#22c55e', '#a855f7'];
const starts = [{x:25,y:5}, {x:5,y:15}, {x:25,y:15}];

for(let i=0; i<3; i++) {
snakes.push({
id: 'bot'+i, color: botColors[i],
body: [{x:starts[i].x, y:starts[i].y}, {x:starts[i].x, y:starts[i].y+1}],
dx: 0, dy: -1, dead: false, isBot: true
});
}

document.getElementById('snake-status-text').innerText = "Playing...";
document.getElementById('snake-status-text').style.color = "#38bdf8";

clearInterval(snakeInterval);
snakeInterval = setInterval(gameLoop, 100);
}

document.onkeydown = e => {
const p = snakes[0];
if(p.dead) return;
if(e.key==='ArrowUp' && p.dy!==1) {p.dx=0;p.dy=-1;}
if(e.key==='ArrowDown' && p.dy!==-1) {p.dx=0;p.dy=1;}
if(e.key==='ArrowLeft' && p.dx!==1) {p.dx=-1;p.dy=0;}
if(e.key==='ArrowRight' && p.dx!==-1) {p.dx=1;p.dy=0;}
};

function gameLoop() {
sCtx.fillStyle = "#2a2a2a";
sCtx.fillRect(0,0,600,400);

snakes.forEach(s => {
if(s.dead) return;

if(s.isBot) {
if(Math.random() < 0.1) {
const moves = [{dx:0,dy:-1},{dx:0,dy:1},{dx:-1,dy:0},{dx:1,dy:0}];
const safeMoves = moves.filter(m => {
if(m.dx === -s.dx && m.dy === -s.dy) return false;
const nx = s.body[0].x + m.dx;
const ny = s.body[0].y + m.dy;
return (nx >=0 && nx < 30 && ny >= 0 && ny < 20);
});
if(safeMoves.length > 0) {
const move = safeMoves[Math.floor(Math.random()*safeMoves.length)];
s.dx = move.dx; s.dy = move.dy;
}
}
}

const head = {x: s.body[0].x + s.dx, y: s.body[0].y + s.dy};

if(head.x < 0 || head.x >= 30 || head.y < 0 || head.y >= 20) {
s.dead = true;
return;
}

snakes.forEach(other => {
if(other.dead) return;
other.body.forEach(seg => {
if(head.x === seg.x && head.y === seg.y) s.dead = true;
});
});

if(s.dead) return;

s.body.unshift(head);
if(s.body.length > 5 && Math.random() > 0.05) s.body.pop();
});

snakes.forEach(s => {
if(s.dead) return;
sCtx.fillStyle = s.color;
s.body.forEach(b => sCtx.fillRect(b.x*20, b.y*20, 18, 18));
sCtx.fillStyle = "white";
sCtx.fillRect(s.body[0].x*20+4, s.body[0].y*20+4, 4, 4);
});

if(snakes[0].dead) {
document.getElementById('snake-status-text').innerText = "Eliminated!";
document.getElementById('snake-status-text').style.color = "red";
}
}
</script>
</body>
</html>